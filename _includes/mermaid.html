<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const style = getComputedStyle(document.documentElement);
        const theme = style.getPropertyValue('--theme').trim() || "dark";
        const panel = style.getPropertyValue('--panel-mid').trim() || "#0b1220";
        const text = style.getPropertyValue('--pref-text-color').trim() || "#e6eef8";
        const accent = style.getPropertyValue('--pref-accent-color').trim() || "#3b82f6";
        const fontFamily = style.getPropertyValue('--pref-font-family').trim() || "Arial, sans-serif";
        mermaid.initialize({ 
            startOnLoad: false,
            theme: theme,
            securityLevel: 'loose',
            themeVariables: {
                background: panel,
                primaryColor: panel,
                primaryTextColor: text,
                primaryBorderColor: accent,
                lineColor: text,
                arrowheadColor: text,
                fontFamily: fontFamily
            }
        });
        
        // Convert fenced code blocks to mermaid divs
        document.querySelectorAll('pre code.language-mermaid').forEach((block, index) => {
            const content = block.textContent;
            const wrapper = document.createElement('div');
            wrapper.className = 'mermaid';
            wrapper.id = 'mermaid-' + index;
            wrapper.textContent = content;
            block.parentElement.parentNode.replaceChild(wrapper, block.parentElement);
        });
        
        mermaid.run();
    });
</script>